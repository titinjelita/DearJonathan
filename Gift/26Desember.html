<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Dear Jonathan Zebuaü§ç</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #2b3a67;
    --sky: #6ca0dc;
    --gray: #e5e5e5;
    --white: #ffffff;
    --text: #333333;
    --shadow: 0 6px 18px rgba(0,0,0,0.1);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Quicksand', sans-serif; -webkit-tap-highlight-color: transparent; }
  html,body { height: 100%; }
  body {
    background: linear-gradient(135deg, var(--navy), var(--sky), var(--gray));
    background-size: 300% 300%;
    animation: bgMove 12s ease infinite;
    overflow: auto;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    color: var(--text);
  }
  @keyframes bgMove {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  .container {
    width: 100%;
    max-width: 820px;
    background: var(--white);
    border-radius: 18px;
    box-shadow: var(--shadow);
    overflow: hidden;
    text-align: center;
    z-index: 2;
    margin: 10px;
  }

  /* === SLIDE EFFECT === */
  .slide {
    display: none;
    padding: 40px 20px 110px;
    animation: fade 0.6s ease;
  }
  .slide.active { display: block; }

  @keyframes fade {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1; transform: translateY(0);}
  }

  /* === PER-SLIDE WARNA === */
  #introSlide {
    background: linear-gradient(160deg, #d7e1f3, #f7f9ff);
  }
  #menuSlide {
    background: linear-gradient(160deg, #ffe3ec, #f9d8ff);
  }
  #ucapanSlide {
    background: linear-gradient(160deg, #fdf2e9, #ffe9d6);
  }
  #hebatSlide {
    background: linear-gradient(160deg, #e6f4ea, #d4f0f0);
  }
  #doaSlide {
    background: linear-gradient(160deg, #fff0f0, #ffe0eb);
  }
  #kadoSlide {
    background: linear-gradient(160deg, #e0e8ff, #f4e1ff);
  }

  h1 { font-size: 28px; color: var(--navy); margin-bottom: 8px; font-weight: 700;margin-top: 110px; }
  h2 { font-size: 22px; color: var(--navy); margin-top: 10px; }
  p { color: #444; max-width: 520px; margin: 8px auto 0; line-height: 1.6; font-size: 15px; }

  .menu { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-top: 18px; }
  .menu-btn {
    background: var(--sky);
    border: none;
    border-radius: 10px;
    padding: 10px 18px;
    font-weight: 600;
    color: var(--white);
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: all 0.25s ease;
    font-size: 15px;
  }
  .menu-btn:hover { background: var(--navy); transform: scale(1.05); }

  .nav-buttons {
    position: sticky;
    bottom: 12px;
    display: flex;
    gap: 12px;
    justify-content: center;
    padding: 14px 0 24px;
    z-index: 3;
  }
  .btn {
    background: var(--sky);
    border: none;
    border-radius: 10px;
    padding: 10px 18px;
    font-weight: 600;
    color: var(--white);
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: all 0.25s ease;
    font-size: 15px;
  }
  .btn:hover { background: var(--navy); transform: scale(1.05); }

  .intro { padding: 12px 12px 6px; }
  .intro h1 { font-size: 18px; color: var(--navy); margin-bottom: 6px; }
  .intro p { color: #444; font-size: 15px; margin-bottom: 14px; }

  /* waktu & countdown */
  .time-display {
    font-size: 16px;
    color: var(--white);
    background: var(--navy);
    display: inline-block;
    padding: 8px 16px;
    border-radius: 12px;
    box-shadow: var(--shadow);
    margin-bottom: 8px;
  }
  .countdown { margin-top: 8px; font-size: 14px; color: #555; }

  .start-btn {
    background: linear-gradient(90deg, var(--sky), var(--navy));
    border: none;
    border-radius: 12px;
    padding: 10px 30px;
    font-size: 16px;
    color: var(--white);
    cursor: pointer;
    font-weight: 700;
    box-shadow: var(--shadow);
    transition: all 0.22s ease;
  }
  .start-btn:hover { transform: scale(1.05); }

  #giftMessage {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: var(--white);
    padding: 18px 22px;
    border-radius: 12px;
    box-shadow: var(--shadow);
    font-size: 18px;
    color: var(--navy);
    text-align: center;
    opacity: 0;
    transition: 0.35s ease;
    z-index: 99;
    max-width: 90%;
  }
  #giftMessage.active { transform: translate(-50%, -50%) scale(1); opacity: 1; }

  canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  /* Tombol musik */
  #musicBtn {
    position: absolute;
    top: 14px;
    right: 14px;
    background: var(--sky);
    border-radius: 50%;
    width: 52px;
    height: 52px;
    font-size: 22px;
    border: none;
    box-shadow: var(--shadow);
    cursor: pointer;
    z-index: 5;
    transition: all 0.25s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--white);
  }
  #musicBtn:hover { background: var(--navy); transform: scale(1.1); }
  #musicBtn.playing { animation: spin 6s linear infinite; }
  @keyframes spin { from {transform: rotate(0);} to {transform: rotate(360deg);} }

  /* image */
  .slide-img1, .slide-img2, .slide-img4 {
    display: block;
    margin: 12px auto 6px;
    object-fit: cover;
    box-shadow: 0 4px 12px rgba(0, 50, 80, 0.3);
  }
  .slide-img1 {
    width: 50%; max-width: 200px; aspect-ratio: 1/1; border-radius: 50%;
  }
  .slide-img2 {
    width: 40%; max-width: 200px; border-radius: 12px;
  }
  .slide-img4 {
    width: 50%; max-width: 220px; border-radius: 12px; aspect-ratio: 3/4;
  }

  @media (max-width: 600px) {
    .slide-img1, .slide-img2, .slide-img4 { width: 80%; max-width: 240px; }
  }

  @media (max-width: 480px) {
    .container { border-radius: 14px; }
    .slide { padding: 24px 14px 100px; }
    h1 { font-size: 22px; }
    h2 { font-size: 20px; }
    p { font-size: 14px; }
    .btn, .menu-btn { font-size: 14px; padding: 9px 14px; }
    #musicBtn { width: 48px; height: 48px; }
  }

  /* === Lilin meleleh dengan tetesan cairan yang jatuh === */
.candle-container {
  position: relative;
  margin-top: 55px; /* jarak dari tulisan hitung mundur */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  height: 150px;
  user-select: none;
}

.candle {
  position: relative;
  width: 60px;
  height: 130px;
  background: linear-gradient(180deg, #fff4cf 0%, #f9d6a3 50%, #e7ae6f 100%);
  border-radius: 16px 16px 10px 10px;
  box-shadow: inset 0 -6px 8px rgba(0,0,0,0.25),
              0 10px 18px rgba(0,0,0,0.2);
  overflow: visible;
}

/* lelehan atas */
.candle::before {
  content: "";
  position: absolute;
  top: -4px;
  left: 0;
  width: 100%;
  height: 30px;
  background: radial-gradient(circle at 50% 10%, #fff6da 0%, #f7d19f 80%);
  border-radius: 16px 16px 0 0;
  clip-path: polygon(0 0, 100% 0, 100% 40%, 80% 80%, 60% 40%, 45% 70%, 25% 35%, 10% 60%, 0 35%);
  z-index: 2;
}

/* lelehan statis di sisi */
.candle::after {
  content: "";
  position: absolute;
  width: 8px;
  height: 30px;
  background: rgba(255, 245, 215, 0.9);
  border-radius: 4px;
  bottom: 15px;
  left: 10px;
  box-shadow: 30px 10px 0 -2px rgba(255, 245, 215, 0.8);
}

/* dasar lilin */
.candle-base {
  position: absolute;
  bottom: -8px;
  left: 50%;
  width: 90px;
  height: 20px;
  background: radial-gradient(circle at 50% 50%, #f6d29a 0%, #e6a86b 70%, transparent 100%);
  border-radius: 50%;
  transform: translateX(-50%);
  filter: blur(0.5px);
  z-index: 0;
}

/* sumbu */
.wick {
  position: absolute;
  top: -16px;
  left: 50%;
  width: 5px;
  height: 16px;
  background: #2d2d2d;
  border-radius: 2px;
  transform: translateX(-50%);
  z-index: 3;
}

/* api */
.flame {
  position: absolute;
  top: -60px;
  left: 50%;
  width: 26px;
  height: 46px;
  background: radial-gradient(circle at 50% 65%, #fff8a8 10%, #ffb300 60%, rgba(255,140,0,0.2) 100%);
  border-radius: 50%;
  transform: translateX(-50%) scale(1);
  animation: flameFlicker 1.2s infinite ease-in-out alternate;
  box-shadow: 0 0 40px 12px rgba(255, 200, 0, 0.6);
  filter: blur(0.5px);
  opacity: 1;
  z-index: 2;
}

.candle.off .flame {
  opacity: 0;
  animation: none;
  box-shadow: none;
  transition: opacity 0.6s ease-out;
}

/* animasi api */
@keyframes flameFlicker {
  0% { transform: translateX(-50%) scale(1) translateY(0); opacity: 1; filter: brightness(1); }
  40% { transform: translateX(-51%) scale(1.08) translateY(-3px); filter: brightness(1.1); }
  80% { transform: translateX(-49%) scale(0.95) translateY(2px); filter: brightness(0.9); }
  100% { transform: translateX(-50%) scale(1) translateY(0); filter: brightness(1); }
}

/* === Efek tetesan lilin jatuh === */
@keyframes waxDrop {
  0% {
    transform: translateY(0);
    opacity: 1;
  }
  80% {
    opacity: 1;
  }
  100% {
    transform: translateY(90px);
    opacity: 0;
  }
}

.drip {
  position: absolute;
  width: 6px;
  height: 16px;
  background: rgba(255, 245, 215, 0.95);
  border-radius: 50%;
  top: 10px;
  left: 16px;
  animation: waxDrop 4s linear infinite;
  animation-delay: 0s;
  z-index: 1;
}

.drip:nth-child(2) {
  left: 35px;
  animation-delay: 2s;
}

.drip:nth-child(3) {
  left: 22px;
  animation-delay: 1s;
}

/* teks bawah */
.candle-container p {
  font-size: 13px;
  color: rgb(126, 111, 111);
  margin-top: 15px;
}



</style>

</head>
<body>

<canvas id="confetti"></canvas>

<div class="container" role="main" aria-labelledby="mainHeading">
  <!-- Tombol musik -->
  <button id="musicBtn" aria-pressed="false" aria-label="Play music">üéµ</button>

  <!-- Player YouTube tersembunyi -->
  <div id="player" style="display:none;"></div>

  <!-- Fallback audio lokal: ganti src dengan file audio Anda (mis. audio/bgm.mp3) -->
  <audio id="localAudio" preload="none">
    <!-- Contoh: <source src="audio/bgm.mp3" type="audio/mpeg"> -->
    <!-- Jika Anda ingin memutar file lokal di Android, masukkan source di atas -->
  </audio>

  <div class="slide active" id="introSlide">
    <div class="intro">
      <h1 id="mainHeading">üéÄ 26 Desember 2025 üéÇ</h1>

      <div class="time-display" id="currentTime">00:00:00</div>
      <div class="countdown" id="countdownText">Hitung mundur menuju ulang tahun...</div>

     <div class="candle-container">
  <div class="candle">
    <div class="wick"></div>
    <div class="flame"></div>
    <!-- Tetesan lilin -->
    <div class="drip"></div>
    <div class="drip"></div>
    <div class="drip"></div>
    <div class="candle-base"></div>
  </div>
  <p>tiup lilinnya ‚ú®</p>

  </div>
      <p><b>26 Desember 2004 - 26 Desember 2025</b></p>
      <p>DEAR JONATHAN ZEBUAü§ç</p>
      <p>Klik tombol di bawah ini</p>
      <button class="start-btn" id="startBtn">Klik Disini üí´</button>
    </div>
  </div>

  <div class="slide" id="menuSlide">
    <h2>Menu Spesial üåπ</h2>
    <p>Pilih menu untuk melihat pesan spesial dari Titin üòÉ!</p>

    <img class="slide-img1" id="imgMenu" alt="Foto Menu (ganti dengan foto Anda)" src="images/1.jpeg">

    <!-- GANTI BAGIAN MENU DI DALAM #menuSlide -->
    <div class="menu">
      <button class="menu-btn" data-slide="ucapan">Ucapan üéÇ</button>
      <button class="menu-btn" data-slide="hebat">TentangMu üåà</button>
      <button class="menu-btn" data-slide="doa">Harapan üíñ</button>
      <button class="menu-btn" data-slide="kado">Kejutan üéÅ</button>
      <button class="menu-btn" data-slide="ayat">Ayat Emas ‚ú®</button>
    </div>
  </div>

  <div class="slide" id="ucapanSlide">
    <h2>üéÇ Selamat Ulang Tahun Sayang!</h2>
    <img class="slide-img2" id="imgUcapan" alt="Foto Ucapan (ganti dengan foto Anda)" src="images/2.jpeg">
    <p> "Nggak terasa udah nambah usia aja, padahal perasaan kemarin kita baru merayain pakai lilin pulang dari perayaan natal, biarpun ngerayainnya hanya di layar Hp karna jarak yang memisahkan kitaü§≠, namun tetap bersyukur kok ü§ó.
    Makasih ya udah jadi orang yang selalu ada buat ku, yang nggak pernah skip dengerin drama ku,dan yang paling jago bikin ketawa kalau lagi bad mood.kadang juga buat kesal sih üòÖ.  SEKALI LAGI SELAMAT ULANG TAHUN YAHHHH...."
      
     </p>
  </div>

  <div class="slide" id="hebatSlide">
    <h2>Tentang Mu üíù</h2>
    <p>"Hari ini adalah hari tentang mu. Dimana 21 Tahun yang lalu, pada tanggal 26 Desember 2004, Tuhan telah memepercayakan dirimu untuk terlahir di dunia ini. Bertemu banyak hal yang menjadi pembelajaran, termasuk juga bertemu dengan ku tanpa ada kesengajaan sehingga memilihku untuk menjadi penyemangat. diantara jutaan pembelajaran hidup yang sudah kamu lalui, baik susah maupun senang, bertemu dengan ku juga termasuk salah satu pembelajaran yang diberikan Tuhan untuk mu, dimana kesabaran mu  di uji. Semoga sabar mu seluas samudera, dan kasih mu sedalam lautan üå∑üí´".
    </p>
  </div>

  <div class="slide" id="doaSlide">
    <h2>üíñ Doa Terbaik</h2>
    <p>"Semoga dihari yang penuh rasa syukur ini dan seterusnya, dirimu selalu diliputi oleh kedamaian dan kebahagiaan dari Bapa disorga. Semoga Tuhan menjaga hati dan langkahmu, menjauhkanmu dari segala kesulitan, dan mempermudah jalanmu menuju impian. aku berharap Bapa senantiasa memberi kekuatan untuk menjadi pribadi yang lebih sabar, lebih ikhlas, dan lebih bermanfaat. Semoga dirimu selalu berada di jalan kebaikan, dimudahkan dalam mencari rezeki, dan dapat membahagiakan orang-orang disekitarmu ü§ó"</p>
  </div>

  <div class="slide" id="ayatSlide">
  <h2>üåü Ayat Emas üåü</h2>
  <p>"Umur panjang ada di tangan kanannya, di tangan kirinya kekayaan dan kehormatan" 
  <br><b>‚Äî Amsal 3:16 ‚ú®</b></p>
  <P></P>
  <p>"Kiranya diberikan-Nya kepadamu apa yang kaukehendaki dan dijadikan-Nya berhasil apa yang kaurancangkan" 
  <br><b>‚Äî Mazmur 20:25 ‚ú®</b></p>
</div>


  <div class="slide" id="kadoSlide">
    <h2>üéÅ Kejutan !...</h2>
    <img class="slide-img4" id="imgKado" src="images/4.jpeg">
    <p>Klik tombol di bawah untuk membuka pesan istimewa Dari Titin ü§≠</p>
    <button class="btn" id="giftBtn">Buka Hadiah üíå</button>
  </div>
  

  <div class="nav-buttons" id="navWrap">
    <button class="btn" id="backToIntroBtn" style="display:none;">üè† Kembali</button>
    <button class="btn" id="backToMenuBtn" style="display:none;">‚¨ÖÔ∏è Menu</button>
  </div>

  <div id="giftMessage">  
  "Terima kasih sudah menjadi pribadi yang baik, dan selalu rendah hati. Semoga Tuhan selalu menyertai dirimu dan memberkati prosesmu sekarang sampai selama-lamanya üòáüôè"</div>
</div>

<!-- === SCRIPT === -->
<script>
/* -----------------------
   SLIDE NAVIGASI
   ----------------------- */
const slides = document.querySelectorAll('.slide');
function showSlide(id){
  slides.forEach(s=>s.classList.remove('active'));
  const el = document.getElementById(id);
  if (!el) return;
  el.classList.add('active');

  const backMenuBtn = document.getElementById('backToMenuBtn');
  const backIntroBtn = document.getElementById('backToIntroBtn');

  if (id === 'introSlide') {
    backMenuBtn.style.display = 'none';
    backIntroBtn.style.display = 'none';
  } else if (id === 'menuSlide') {
    backMenuBtn.style.display = 'none';
    backIntroBtn.style.display = 'block';
  } else {
    backMenuBtn.style.display = 'block';
    backIntroBtn.style.display = 'block';
  }
}
document.getElementById('startBtn').onclick=()=>showSlide('menuSlide');
document.querySelectorAll('.menu-btn').forEach(btn=>{
  btn.onclick=()=>showSlide(btn.dataset.slide+'Slide');
});
document.getElementById('backToMenuBtn').onclick=()=>showSlide('menuSlide');
document.getElementById('backToIntroBtn').onclick=()=>showSlide('introSlide');

/* -----------------------
   JAM & COUNTDOWN
   ----------------------- */
const timeDisplay = document.getElementById("currentTime");
const countdownText = document.getElementById("countdownText");

function updateTime() {
  const now = new Date();
  // local time shown using device timezone; target has +07:00 (Asia/Jakarta)
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const s = String(now.getSeconds()).padStart(2,'0');
  timeDisplay.textContent = `${h}:${m}:${s}`;

  // target tanggal (Asia/Jakarta) -> gunakan offset +07:00
  const target = new Date("2025-12-26T00:00:00+07:00").getTime();
  const diff = target - now.getTime();

  if (diff > 0) {
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const mins = Math.floor((diff / (1000 * 60)) % 60);
    const secs = Math.floor((diff / 1000) % 60);
    countdownText.textContent = `Hitung mundur: ${days} hari ${hours} jam ${mins} menit ${secs} detik`;
  } else {
    countdownText.textContent = "kamu hebat sudah bertahan selama 21 Tahun!";
  }
}
// run once immediately to avoid 1s delay
updateTime();
setInterval(updateTime, 1000);

/* -----------------------
   CONFETTI (STAR/HEART) ANIMASI
   ----------------------- */
const canvas=document.getElementById("confetti"),ctx=canvas.getContext("2d");
let shapes=[];
function resizeCanvas(){canvas.width=innerWidth;canvas.height=innerHeight;}
window.addEventListener("resize",resizeCanvas);resizeCanvas();
function createShape(){const isStar=Math.random()>0.5;return{x:Math.random()*canvas.width,y:canvas.height+Math.random()*50,size:Math.random()*16+10,speed:Math.random()*0.8+0.3,opacity:Math.random()*0.5+0.3,rotation:Math.random()*Math.PI*2,shape:isStar?'star':'heart',color:isStar?`rgba(160,196,255,${Math.random()*0.6+0.4})`:`rgba(255,198,255,${Math.random()*0.6+0.4})`};}
for(let i=0;i<40;i++)shapes.push(createShape());
function drawShape(s){ctx.save();ctx.translate(s.x,s.y);ctx.rotate(s.rotation);ctx.globalAlpha=s.opacity;ctx.fillStyle=s.color;if(s.shape==='star'){drawStar(0,0,5,s.size/2,s.size/4);}else{drawHeart(0,0,s.size/1.2);}ctx.fill();ctx.restore();}
function drawStar(x,y,p,o,i){const step=Math.PI/p;ctx.beginPath();for(let j=0;j<2*p;j++){const r=j%2===0?o:i;const a=j*step;ctx.lineTo(x+Math.cos(a)*r,y+Math.sin(a)*r);}ctx.closePath();}
function drawHeart(x,y,s){ctx.beginPath();ctx.moveTo(x,y+s/4);ctx.bezierCurveTo(x+s/2,y-s/2,x+s,y+s/3,x,y+s);ctx.bezierCurveTo(x-s,y+s/3,x-s/2,y-s/2,x,y+s/4);ctx.closePath();}
function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);shapes.forEach(s=>{drawShape(s);s.y-=s.speed;s.rotation+=0.002;if(s.y<-50){s.x=Math.random()*canvas.width;s.y=canvas.height+50;s.shape=Math.random()>0.5?'star':'heart';}});requestAnimationFrame(animate);}animate();

/* -----------------------
   HADIAH (popup)
   ----------------------- */
document.getElementById("giftBtn").onclick=()=>{const msg=document.getElementById("giftMessage");msg.classList.add("active");setTimeout(()=>msg.classList.remove("active"),4000);};

/* -----------------------
   YOUTUBE MUSIK + AUDIO FALLBACK
   - Memiliki dua opsi pemutaran:
     1) Jika user memasukkan audio lokal (di <audio id="localAudio">), tombol akan mengontrol audio lokal.
     2) Jika tidak ada audio lokal, gunakan YouTube iframe API (video tersembunyi).
   - Catatan: autoplay di mobile sering dibatasi oleh browser; pengguna biasanya harus menyentuh halaman (tombol) untuk mulai.
   ----------------------- */
let player = null;
let playerReady = false;
let usingLocal = false;

function onYouTubeIframeAPIReady() {
  try {
    player = new YT.Player('player', {
      height: '0',
      width: '0',
      videoId: 'HDRsMqNhMLc', // video default
      playerVars: {
        autoplay: 0,
        start: 10,
        controls: 0,
        modestbranding: 1,
        rel: 0
      },
      events: {
        'onReady': function() {
          playerReady = true;
          // hide or keep player div hidden (kept hidden)
          // console.log("YouTube player siap");
        },
        'onStateChange': function(event){
          // remove playing class if paused/stopped
          const musicBtn = document.getElementById("musicBtn");
          if (event.data === YT.PlayerState.PLAYING) {
            musicBtn.classList.add("playing");
            musicBtn.setAttribute("aria-pressed","true");
          } else {
            musicBtn.classList.remove("playing");
            musicBtn.setAttribute("aria-pressed","false");
          }
        }
      }
    });
  } catch(e){
    console.warn("Gagal membuat YouTube player:", e);
  }
}

// inject YT API script
(function addYT(){
  const tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  tag.async = true;
  document.body.appendChild(tag);
})();

// local audio element
const localAudio = document.getElementById('localAudio');

const musicBtn = document.getElementById("musicBtn");
function stopAllAudio(){
  try{
    if (player && playerReady) {
      player.pauseVideo();
    }
  } catch(e){}
  try{
    if (localAudio && !localAudio.paused) {
      localAudio.pause();
      localAudio.currentTime = 0;
    }
  } catch(e){}
  musicBtn.classList.remove("playing");
  musicBtn.setAttribute("aria-pressed","false");
}

musicBtn.addEventListener("click", async function(){
  // If local audio has a source, prefer it (explicit fallback)
  const hasLocalSource = localAudio.querySelector('source') || localAudio.src;
  if (hasLocalSource) {
    usingLocal = true;
    try {
      if (localAudio.paused) {
        // Some mobile browsers require play() to be called in user gesture (we are in click handler -> ok)
        await localAudio.play();
        musicBtn.classList.add("playing");
        musicBtn.setAttribute("aria-pressed","true");
      } else {
        localAudio.pause();
        musicBtn.classList.remove("playing");
        musicBtn.setAttribute("aria-pressed","false");
      }
    } catch(err){
      console.warn("Gagal memutar audio lokal:", err);
      alert("Gagal memutar audio lokal. Pastikan format file didukung (mp3) dan coba lagi.");
    }
    return;
  }

  // Otherwise try YouTube player
  if (playerReady && player) {
    try {
      const state = player.getPlayerState();
      // if not playing, play; else pause
      if (state !== YT.PlayerState.PLAYING) {
        player.playVideo();
        musicBtn.classList.add("playing");
        musicBtn.setAttribute("aria-pressed","true");
      } else {
        player.pauseVideo();
        musicBtn.classList.remove("playing");
        musicBtn.setAttribute("aria-pressed","false");
      }
    } catch(err){
      console.warn("YouTube control error:", err);
      alert("Terjadi masalah saat mengontrol pemutar YouTube.");
    }
  } else {
    // If player not ready yet, inform user and try to initialize after user gesture
    // Try to create minimal player if YT failed to load
    if (typeof YT === 'undefined') {
      alert("Pemutar YouTube belum siap. Pastikan perangkat terhubung internet, atau gunakan audio lokal dengan menambahkan file mp3 ke <audio id='localAudio'>.");
    } else {
      // in case api loaded but onReady not fired yet
      alert("Pemutar sedang disiapkan, coba klik lagi sebentar.");
    }
  }
});

// Pause local audio if user switches slides or opens menu (optional polite behavior)
document.querySelectorAll('.menu-btn, #backToIntroBtn, #backToMenuBtn').forEach(el=>{
  el.addEventListener('click', ()=> {
    try {
      if (localAudio && !localAudio.paused) localAudio.pause();
    } catch(e){}
  });
});

/* -----------------------
   NOTES FOR USER (IN-CODE)
   - Untuk mengganti gambar di tiap slide, ganti file src pada elemen <img id="imgIntro"> dst:
     contoh: <img id="imgIntro" src="images/intro-template.jpg">
     ganti menjadi: src="images/foto_saya.jpg"
   - Untuk menggunakan audio lokal (fallback), tambahkan source di tag <audio id="localAudio">:
     <audio id="localAudio" preload="none">
       <source src="audio/my-bgm.mp3" type="audio/mpeg">
     </audio>
   - Jika ingin mengganti video YouTube, ubah videoId di bagian onYouTubeIframeAPIReady / konfigurasi player.
   ----------------------- */

/* End of script */
/* === Efek Lilin: mati saat ditiup, nyala otomatis kembali === */
let candle = document.querySelector('.candle');
let flame = document.querySelector('.flame');
let relightTimer;

function toggleCandle() {
  if (candle.classList.contains('off')) {
    candle.classList.remove('off');
    clearTimeout(relightTimer);
  } else {
    candle.classList.add('off');
    clearTimeout(relightTimer);
    relightTimer = setTimeout(() => {
      candle.classList.remove('off');
    }, 5000); // nyala lagi setelah 5 detik
  }
}

// deteksi tiupan dari mikrofon
async function detectBlow() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioCtx.createMediaStreamSource(stream);
    const analyser = audioCtx.createAnalyser();
    const dataArray = new Uint8Array(analyser.fftSize);
    source.connect(analyser);

    function listen() {
      analyser.getByteTimeDomainData(dataArray);
      let sum = 0;
      for (let i = 0; i < dataArray.length; i++) {
        const deviation = dataArray[i] - 128;
        sum += Math.abs(deviation);
      }
      const volume = sum / dataArray.length;

      // jika terdeteksi hembusan kuat, padamkan api
      if (volume > 12 && !candle.classList.contains('off')) {
        candle.classList.add('off');
        clearTimeout(relightTimer);
        relightTimer = setTimeout(() => {
          candle.classList.remove('off');
        }, 5000);
      }

      requestAnimationFrame(listen);
    }

    listen();
  } catch (err) {
    console.warn("Mikrofon tidak aktif:", err);
  }
}

detectBlow();


</script>
</body>
</html>
